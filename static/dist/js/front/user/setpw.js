define(function(require,exports,module){this.validate=require("js/base/validate"),this.md5=require("js/base/utils/hrymd5"),module.exports={init:function(){clearPageTimer(),$("#submitBtn").on("click",function(){var s=$("#oldPassWord").val(),e=$("#newPassWord").val(),a=$("#reNewPassWord").val(),d=$("#pwSmsCode").val();return s?e?e==s?void layer.msg("新登录密码不能和原始登录密码一致",{icon:2}):validate.check_password(e)?a?e!=a?void layer.msg("两次密码不一致",{icon:2}):d?($("#submitBtn").attr("disabled","disabled"),void $.ajax({type:"post",url:_ctx+"/user/setpw",data:{oldPassWord:md5.md5(s),newPassWord:md5.md5(e),reNewPassWord:md5.md5(a),pwSmsCode:d},cache:!1,dataType:"json",success:function(s){s?s.success?layer.msg("修改成功!",{icon:1,time:1e3},function(){window.location.href=_ctx+"/user/center"}):(layer.msg(s.msg,{icon:2}),$("#submitBtn").removeAttr("disabled")):(layer.msg("修改失败",{icon:2}),$("#submitBtn").removeAttr("disabled"))},error:function(s){}})):void layer.msg("短信验证码不能为空",{icon:2}):void layer.msg("第二次密码不能为空",{icon:2}):void layer.msg("新密码格式不正确",{icon:2}):void layer.msg("新登录密码不能为空",{icon:2}):void layer.msg("原始登录密码不能为空",{icon:2})})},sendsms:function(){$("#sendsmsBtn").on("click",function(){var s=$("#oldPassWord").val(),e=$("#newPassWord").val(),a=$("#reNewPassWord").val();return s?e?e==s?void layer.msg("新登录密码不能和原始登录密码一致",{icon:2}):validate.check_password(e)?a?e!=a?void layer.msg("两次密码不一致",{icon:2}):($(this).attr("disabled","disabled"),$(this).html("已发送"),void $.ajax({type:"post",url:_ctx+"/sms/getPwSmsCode",data:{oldPassWord:md5.md5(s),newPassWord:md5.md5(e),reNewPassWord:md5.md5(a)},cache:!1,dataType:"json",success:function(s){if(s)if(s.success){layer.msg("发送成功",{icon:1});var e=120;window.clearInterval(pageTimer.setpw),pageTimer.setpw=window.setInterval(function(){e-=1,0==e?($("#sendsmsBtn").html("点击"),$("#sendsmsBtn").removeAttr("disabled"),$("#sms_message").html(""),window.clearInterval(registSmsCodeT1)):$("#sms_message").html(e+"秒后重新获取")},1e3)}else $("#sendsmsBtn").removeAttr("disabled"),layer.msg(s.msg,{icon:2});else $("#sendsmsBtn").removeAttr("disabled"),layer.msg("发送失败",{icon:2})},error:function(s){}})):void layer.msg("第二次密码不能为空",{icon:2}):void layer.msg("新密码格式不正确",{icon:2}):void layer.msg("新登录密码不能为空",{icon:2}):void layer.msg("原始登录密码不能为空",{icon:2})})}}});
define(function(require,exports,module){this._table=require("js/base/table"),module.exports={init:function(){$("#Popup").hide(),$.ajax({type:"POST",dataType:"JSON",url:_ctx+"/user/rmbdeposit/selectRedisBank",cache:!1,success:function(data){for(var json=eval(data.obj),html="",i=0;i<json.length;i++)html+="<li class='morebank' id='li"+json[i].id+"'><input type='hidden' value='"+json[i].id+"'/><input type='hidden' name='bankName' id='bankName' value='"+json[i].itemName+"'/><img width='128px' height='38px' src="+_ctx+"/"+json[i].remark2+"></li>";html+="<li id='showOther' class='morebank' style='display: none;' ><a >查看更多+</a></li><li id='closeOther'  class='morebank' style='display: block;' ><a >收起 -</a></li>",$("#bankList").append(html)}});var bankFlag=!1,remitterFlag=0,bankCodeFlag=0,bankAmountFlag=0,selectedBankName=0;$("#bankList").on("click","li[id=showOther]",function(){for(var e=$("#bankList").children("li"),a=0;a<e.length;a++)"showOther"!=$(e[a]).attr("id")?$(e[a]).css("display",""):$(e[a]).css("display","none")}),$("#bankList").on("click","li[id=closeOther]",function(){for(var e=$("#bankList").children("li"),a=8;a<e.length;a++)"showOther"!=$(e[a]).attr("id")?$(e[a]).css("display","none"):$(e[a]).css("display","")}),$("#bankList").on("click","li",function(){$("#bankList li i").each(function(){$("#bankList li i").removeClass("icon_checked")});$(this).append("<i class='icon_checked'></i>"),bankFlag=!0,selectedBankName=$("#bankName").val()}),$("#remitter").on("blur",function(){var e=this.value;if(""==e)layer.msg("汇款人姓名必填",{icon:2}),remitterFlag=1;else{/[\u4E00-\u9FA5]|[\uFE30-\uFFA0]/gi.test(e)?remitterFlag=0:(layer.msg("汇款人姓名必须为中文",{icon:2}),remitterFlag=2)}}),$("#bankCode").on("blur",function(){var e=this.value;if(""==e)layer.msg("银行卡号必填",{icon:2}),bankCodeFlag=1;else{var a,t,i;if(i="0123456789",0==e.length)return 0;for(a=0;a<e.length;a++)t=i.indexOf(e.charAt(a)),-1==t?(layer.msg("银行卡号必须为数字",{icon:2}),bankCodeFlag=2):bankCodeFlag=0}}),$("#bankAmount").on("blur",function(){var e=this.value;if(""==e)layer.msg("金额不能为空",{icon:2}),bankAmountFlag=1;else{if(/(^[1-9]([0-9]+)?(\.[0-9]{1,2})?$)|(^(0){1}$)|(^[0-9]\.[0-9]([0-9])?$)/.test(e)){bankAmountFlag=0;var a=$("#onlineRechargeFeeRate").val()/100*e;$("#promptShow").empty().text("手续费额: "+a+"RMB, 实际到账金额:"+(e-a)+"RMB ,  请严格按照当前数量汇款。")}else layer.msg("金额格式不正确",{icon:2}),bankAmountFlag=2}}),$("#generate_single").on("click",function(){return 0==bankFlag?(layer.msg("请选择银行",{icon:2}),!1):1==remitterFlag?(layer.msg("汇款人姓名必填",{icon:2}),!1):2==remitterFlag?(layer.msg("汇款人姓名必须为中文",{icon:2}),!1):1==bankCodeFlag?(layer.msg("银行卡号必填",{icon:2}),!1):2==bankCodeFlag?(layer.msg("银行卡号必须为数字",{icon:2}),!1):1==bankAmountFlag?(layer.msg("金额不能为空",{icon:2}),!1):2==bankAmountFlag?(layer.msg("金额格式不正确",{icon:2}),!1):($("#generate_single").attr("disabled",!0),$("#generate_single").empty().text("Loading..."),void $("#cg_bankForm_offline").ajaxSubmit({type:"post",url:_ctx+"/user/rmbdeposit/rmbdeposit",dataType:"JSON",data:{bankName:selectedBankName},resetForm:!0,success:function(e){e.success?($("#generate_single").attr("disabled",!1),$("#generate_single").empty().text("生成银行汇款单"),$("#bankAccount").empty().html("<b>"+e.obj.accountNumber+"</b>"),$("#bankName_").empty().html(e.obj.bankName),$("#bankAddress").empty().html(e.obj.bankAddress),$("#accountName").empty().html(e.obj.accountName),$("#remittanceMoney").empty().html("<b>"+e.obj.transactionMoney+" (汇款时时填写金额)</b>"),$("#transactionNum").empty().text(e.obj.transactionNum),$("#remark").empty().html("<b>"+e.obj.remark+"  (汇款时备注内容)</b>"),layer.open({type:1,title:"",area:["500px","550px"],scrollbar:!1,shadeClose:!1,content:$("#Popup")}),$("#table").bootstrapTable("refresh")):layer.alert(e.msg)}}))});var conf={url:_ctx+"/user/rmbdeposit/list",columns:[{field:"state",checkbox:!0,align:"center",valign:"middle",value:"id",visible:!1,searchable:!1},{title:"id",field:"id",align:"center",visible:!1,sortable:!1,searchable:!1},{title:"充值类型",field:"transactionType",align:"center",visible:!0,sortable:!1,searchable:!0,formatter:function(e,a,t){return 1==e?"线上充值":2==e?"线上提现":3==e?"线下充值":3==e?"线下取现":void 0}},{title:"充值金额",field:"transactionMoney",align:"center",visible:!0,sortable:!1,searchable:!0},{title:"手续费",field:"fee",align:"center",visible:!0,sortable:!1,searchable:!0},{title:"订单号",field:"transactionNum",align:"center",visible:!0,sortable:!1,searchable:!0},{title:"时间",field:"created",align:"center",visible:!0,sortable:!1,searchable:!0},{title:"状态",field:"status",align:"center",visible:!0,sortable:!1,searchable:!0,formatter:function(e,a,t){return 1==e?"待审核":2==e?"已完成":3==e?"已否决":void 0}}],queryParams:function(e){return{limit:e.limit,offset:e.offset,sortOrder:e.order,status:$($("#status").find(".selected")[0]).attr("value"),transactionType:"chongzhi"}}};_table.initTable($("#table"),conf),$("#status").on("click","a",function(){$(this).siblings().removeClass("selected"),$(this).addClass("selected"),$("#table").bootstrapTable("refresh",null)})}}});
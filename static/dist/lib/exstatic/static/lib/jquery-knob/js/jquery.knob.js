!function($){"use strict";var t={},i=Math.max,s=Math.min;t.c={},t.c.d=$(document),t.c.t=function(t){return t.originalEvent.touches.length-1},t.o=function(){var i=this;this.o=null,this.$=null,this.i=null,this.g=null,this.v=null,this.cv=null,this.x=0,this.y=0,this.$c=null,this.c=null,this.t=0,this.isInit=!1,this.fgColor=null,this.pColor=null,this.dH=null,this.cH=null,this.eH=null,this.rH=null,this.run=function(){var t=function(t,s){var h;for(h in s)i.o[h]=s[h];i.init(),i._configure()._draw()};if(!this.$.data("kontroled"))return this.$.data("kontroled",!0),this.extend(),this.o=$.extend({min:this.$.data("min")||0,max:this.$.data("max")||100,stopper:!0,readOnly:this.$.data("readonly"),cursor:!0===this.$.data("cursor")&&30||this.$.data("cursor")||0,thickness:this.$.data("thickness")||.35,lineCap:this.$.data("linecap")||"butt",width:this.$.data("width")||200,height:this.$.data("height")||200,displayInput:null==this.$.data("displayinput")||this.$.data("displayinput"),displayPrevious:this.$.data("displayprevious"),fgColor:this.$.data("fgcolor")||"#87CEEB",inputColor:this.$.data("inputcolor")||this.$.data("fgcolor")||"#87CEEB",inline:!1,step:this.$.data("step")||1,draw:null,change:null,cancel:null,release:null},this.o),this.$.is("fieldset")?(this.v={},this.i=this.$.find("input"),this.i.each(function(t){var s=$(this);i.i[t]=s,i.v[t]=s.val(),s.bind("change",function(){var h={};h[t]=s.val(),i.val(h)})}),this.$.find("legend").remove()):(this.i=this.$,this.v=this.$.val(),""==this.v&&(this.v=this.o.min),this.$.bind("change",function(){i.val(i._validate(i.$.val()))})),!this.o.displayInput&&this.$.hide(),this.$c=$('<canvas width="'+this.o.width+'px" height="'+this.o.height+'px"></canvas>'),this.c=this.$c[0].getContext("2d"),this.$.wrap($('<div style="'+(this.o.inline?"display:inline;":"")+"width:"+this.o.width+"px;height:"+this.o.height+'px;"></div>')).before(this.$c),this.v instanceof Object?(this.cv={},this.copy(this.v,this.cv)):this.cv=this.v,this.$.bind("configure",t).parent().bind("configure",t),this._listen()._configure()._xy().init(),this.isInit=!0,this._draw(),this},this._draw=function(){var t=!0,s=document.createElement("canvas");s.width=i.o.width,s.height=i.o.height,i.g=s.getContext("2d"),i.clear(),i.dH&&(t=i.dH()),!1!==t&&i.draw(),i.c.drawImage(s,0,0),s=null},this._touch=function(s){var h=function(t){var s=i.xy2val(t.originalEvent.touches[i.t].pageX,t.originalEvent.touches[i.t].pageY);s!=i.cv&&(i.cH&&!1===i.cH(s)||(i.change(i._validate(s)),i._draw()))};return this.t=t.c.t(s),h(s),t.c.d.bind("touchmove.k",h).bind("touchend.k",function(){t.c.d.unbind("touchmove.k touchend.k"),i.rH&&!1===i.rH(i.cv)||i.val(i.cv)}),this},this._mouse=function(s){var h=function(t){var s=i.xy2val(t.pageX,t.pageY);s!=i.cv&&(i.cH&&!1===i.cH(s)||(i.change(i._validate(s)),i._draw()))};return h(s),t.c.d.bind("mousemove.k",h).bind("keyup.k",function(s){if(27===s.keyCode){if(t.c.d.unbind("mouseup.k mousemove.k keyup.k"),i.eH&&!1===i.eH())return;i.cancel()}}).bind("mouseup.k",function(s){t.c.d.unbind("mousemove.k mouseup.k keyup.k"),i.rH&&!1===i.rH(i.cv)||i.val(i.cv)}),this},this._xy=function(){var t=this.$c.offset();return this.x=t.left,this.y=t.top,this},this._listen=function(){return this.o.readOnly?this.$.attr("readonly","readonly"):(this.$c.bind("mousedown",function(t){t.preventDefault(),i._xy()._mouse(t)}).bind("touchstart",function(t){t.preventDefault(),i._xy()._touch(t)}),this.listen()),this},this._configure=function(){return this.o.draw&&(this.dH=this.o.draw),this.o.change&&(this.cH=this.o.change),this.o.cancel&&(this.eH=this.o.cancel),this.o.release&&(this.rH=this.o.release),this.o.displayPrevious?(this.pColor=this.h2rgba(this.o.fgColor,"0.4"),this.fgColor=this.h2rgba(this.o.fgColor,"0.6")):this.fgColor=this.o.fgColor,this},this._clear=function(){this.$c[0].width=this.$c[0].width},this._validate=function(t){return~~((t<0?-.5:.5)+t/this.o.step)*this.o.step},this.listen=function(){},this.extend=function(){},this.init=function(){},this.change=function(t){},this.val=function(t){},this.xy2val=function(t,i){},this.draw=function(){},this.clear=function(){this._clear()},this.h2rgba=function(t,i){var s;return t=t.substring(1,7),s=[parseInt(t.substring(0,2),16),parseInt(t.substring(2,4),16),parseInt(t.substring(4,6),16)],"rgba("+s[0]+","+s[1]+","+s[2]+","+i+")"},this.copy=function(t,i){for(var s in t)i[s]=t[s]}},t.Dial=function(){t.o.call(this),this.startAngle=null,this.xy=null,this.radius=null,this.lineWidth=null,this.cursorExt=null,this.w2=null,this.PI2=2*Math.PI,this.extend=function(){this.o=$.extend({bgColor:this.$.data("bgcolor")||"#EEEEEE",angleOffset:this.$.data("angleoffset")||0,angleArc:this.$.data("anglearc")||360,inline:!0},this.o)},this.val=function(t){if(null==t)return this.v;this.cv=this.o.stopper?i(s(t,this.o.max),this.o.min):t,this.v=this.cv,this.$.val(this.v),this._draw()},this.xy2val=function(t,h){var n,e;return n=Math.atan2(t-(this.x+this.w2),-(h-this.y-this.w2))-this.angleOffset,this.angleArc!=this.PI2&&n<0&&n>-.5?n=0:n<0&&(n+=this.PI2),e=~~(.5+n*(this.o.max-this.o.min)/this.angleArc)+this.o.min,this.o.stopper&&(e=i(s(e,this.o.max),this.o.min)),e},this.listen=function(){var t,h,n=this,e=function(t){t.preventDefault();var i=t.originalEvent,s=i.detail||i.wheelDeltaX,h=i.detail||i.wheelDeltaY,e=parseInt(n.$.val())+(s>0||h>0?n.o.step:s<0||h<0?-n.o.step:0);n.cH&&!1===n.cH(e)||n.val(e)},a=1,o={37:-n.o.step,38:n.o.step,39:n.o.step,40:-n.o.step};this.$.bind("keydown",function(e){var l=e.keyCode;if(l>=96&&l<=105&&(l=e.keyCode=l-48),t=parseInt(String.fromCharCode(l)),isNaN(t)&&(13!==l&&8!==l&&9!==l&&189!==l&&e.preventDefault(),$.inArray(l,[37,38,39,40])>-1)){e.preventDefault();var r=parseInt(n.$.val())+o[l]*a;n.o.stopper&&(r=i(s(r,n.o.max),n.o.min)),n.change(r),n._draw(),h=window.setTimeout(function(){a*=2},30)}}).bind("keyup",function(i){isNaN(t)?h&&(window.clearTimeout(h),h=null,a=1,n.val(n.$.val())):n.$.val()>n.o.max&&n.$.val(n.o.max)||n.$.val()<n.o.min&&n.$.val(n.o.min)}),this.$c.bind("mousewheel DOMMouseScroll",e),this.$.bind("mousewheel DOMMouseScroll",e)},this.init=function(){(this.v<this.o.min||this.v>this.o.max)&&(this.v=this.o.min),this.$.val(this.v),this.w2=this.o.width/2,this.cursorExt=this.o.cursor/100,this.xy=this.w2,this.lineWidth=this.xy*this.o.thickness,this.lineCap=this.o.lineCap,this.radius=this.xy-this.lineWidth/2,this.o.angleOffset&&(this.o.angleOffset=isNaN(this.o.angleOffset)?0:this.o.angleOffset),this.o.angleArc&&(this.o.angleArc=isNaN(this.o.angleArc)?this.PI2:this.o.angleArc),this.angleOffset=this.o.angleOffset*Math.PI/180,this.angleArc=this.o.angleArc*Math.PI/180,this.startAngle=1.5*Math.PI+this.angleOffset,this.endAngle=1.5*Math.PI+this.angleOffset+this.angleArc;var t=i(String(Math.abs(this.o.max)).length,String(Math.abs(this.o.min)).length,2)+2;this.o.displayInput&&this.i.css({width:(this.o.width/2+4>>0)+"px",height:(this.o.width/3>>0)+"px",position:"absolute","vertical-align":"middle","margin-top":(this.o.width/3>>0)+"px","margin-left":"-"+(3*this.o.width/4+2>>0)+"px",border:0,background:"none",font:"bold "+(this.o.width/t>>0)+"px Arial","text-align":"center",color:this.o.inputColor||this.o.fgColor,padding:"0px","-webkit-appearance":"none"})||this.i.css({width:"0px",visibility:"hidden"})},this.change=function(t){this.cv=t,this.$.val(t)},this.angle=function(t){return(t-this.o.min)*this.angleArc/(this.o.max-this.o.min)},this.draw=function(){var t,i,s=this.g,h=this.angle(this.cv),n=this.startAngle,e=n+h,a=1;s.lineWidth=this.lineWidth,s.lineCap=this.lineCap,this.o.cursor&&(n=e-this.cursorExt)&&(e+=this.cursorExt),s.beginPath(),s.strokeStyle=this.o.bgColor,s.arc(this.xy,this.xy,this.radius,this.endAngle,this.startAngle,!0),s.stroke(),this.o.displayPrevious&&(i=this.startAngle+this.angle(this.v),t=this.startAngle,this.o.cursor&&(t=i-this.cursorExt)&&(i+=this.cursorExt),s.beginPath(),s.strokeStyle=this.pColor,s.arc(this.xy,this.xy,this.radius,t,i,!1),s.stroke(),a=this.cv==this.v),s.beginPath(),s.strokeStyle=a?this.o.fgColor:this.fgColor,s.arc(this.xy,this.xy,this.radius,n,e,!1),s.stroke()},this.cancel=function(){this.val(this.v)}},$.fn.dial=$.fn.knob=function(i){return this.each(function(){var s=new t.Dial;s.o=i,s.$=$(this),s.run()}).parent()}}(jQuery);
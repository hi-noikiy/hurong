!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","load-image","load-image-meta","load-image-exif","load-image-ios","canvas-to-blob","./jquery.fileupload-process"],e):e(window.jQuery,window.loadImage)}(function($,e){"use strict";$.blueimp.fileupload.prototype.options.processQueue.unshift({action:"loadImageMetaData",disableImageHead:"@",disableExif:"@",disableExifThumbnail:"@",disableExifSub:"@",disableExifGps:"@",disabled:"@disableImageMetaDataLoad"},{action:"loadImage",prefix:!0,fileTypes:"@",maxFileSize:"@",noRevoke:"@",disabled:"@disableImageLoad"},{action:"resizeImage",prefix:"image",maxWidth:"@",maxHeight:"@",minWidth:"@",minHeight:"@",crop:"@",orientation:"@",forceResize:"@",disabled:"@disableImageResize"},{action:"saveImage",quality:"@imageQuality",type:"@imageType",disabled:"@disableImageResize"},{action:"saveImageMetaData",disabled:"@disableImageMetaDataSave"},{action:"resizeImage",prefix:"preview",maxWidth:"@",maxHeight:"@",minWidth:"@",minHeight:"@",crop:"@",orientation:"@",thumbnail:"@",canvas:"@",disabled:"@disableImagePreview"},{action:"setImage",name:"@imagePreviewName",disabled:"@disableImagePreview"},{action:"deleteImageReferences",disabled:"@disableImageReferencesDeletion"}),$.widget("blueimp.fileupload",$.blueimp.fileupload,{options:{loadImageFileTypes:/^image\/(gif|jpeg|png|svg\+xml)$/,loadImageMaxFileSize:1e7,imageMaxWidth:1920,imageMaxHeight:1080,imageOrientation:!1,imageCrop:!1,disableImageResize:!0,previewMaxWidth:80,previewMaxHeight:80,previewOrientation:!0,previewThumbnail:!0,previewCrop:!1,previewCanvas:!0},processActions:{loadImage:function(i,a){if(a.disabled)return i;var t=this,n=i.files[i.index],s=$.Deferred();return"number"===$.type(a.maxFileSize)&&n.size>a.maxFileSize||a.fileTypes&&!a.fileTypes.test(n.type)||!e(n,function(e){e.src&&(i.img=e),s.resolveWith(t,[i])},a)?i:s.promise()},resizeImage:function(i,a){if(a.disabled||!i.canvas&&!i.img)return i;a=$.extend({canvas:!0},a);var t,n=this,s=$.Deferred(),r=a.canvas&&i.canvas||i.img,d=function(e){e&&(e.width!==r.width||e.height!==r.height||a.forceResize)&&(i[e.getContext?"canvas":"img"]=e),i.preview=e,s.resolveWith(n,[i])};if(i.exif){if(!0===a.orientation&&(a.orientation=i.exif.get("Orientation")),a.thumbnail&&(t=i.exif.get("Thumbnail")))return e(t,d,a),s.promise();i.orientation?delete a.orientation:i.orientation=a.orientation}return r?(d(e.scale(r,a)),s.promise()):i},saveImage:function(e,i){if(!e.canvas||i.disabled)return e;var a=this,t=e.files[e.index],n=$.Deferred();return e.canvas.toBlob?(e.canvas.toBlob(function(i){i.name||(t.type===i.type?i.name=t.name:t.name&&(i.name=t.name.replace(/\..+$/,"."+i.type.substr(6)))),t.type!==i.type&&delete e.imageHead,e.files[e.index]=i,n.resolveWith(a,[e])},i.type||t.type,i.quality),n.promise()):e},loadImageMetaData:function(i,a){if(a.disabled)return i;var t=this,n=$.Deferred();return e.parseMetaData(i.files[i.index],function(e){$.extend(i,e),n.resolveWith(t,[i])},a),n.promise()},saveImageMetaData:function(e,i){if(!(e.imageHead&&e.canvas&&e.canvas.toBlob)||i.disabled)return e;var a=e.files[e.index],t=new Blob([e.imageHead,this._blobSlice.call(a,20)],{type:a.type});return t.name=a.name,e.files[e.index]=t,e},setImage:function(e,i){return e.preview&&!i.disabled&&(e.files[e.index][i.name||"preview"]=e.preview),e},deleteImageReferences:function(e,i){return i.disabled||(delete e.img,delete e.canvas,delete e.preview,delete e.imageHead),e}}})});
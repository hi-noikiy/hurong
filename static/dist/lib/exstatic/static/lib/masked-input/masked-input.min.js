!function(e){var t,n=function(){var e=document.createElement("input"),t="onpaste";return e.setAttribute(t,""),"function"==typeof e[t]?"paste":"input"}()+".mask",a=navigator.userAgent,r=/iphone/i.test(a),i=/android/i.test(a);e.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},dataName:"rawMaskFn",placeholder:"_"},e.fn.extend({caret:function(e,t){var n;if(0!==this.length&&!this.is(":hidden"))return"number"==typeof e?(t="number"==typeof t?t:e,this.each(function(){this.setSelectionRange?this.setSelectionRange(e,t):this.createTextRange&&(n=this.createTextRange(),n.collapse(!0),n.moveEnd("character",t),n.moveStart("character",e),n.select())})):(this[0].setSelectionRange?(e=this[0].selectionStart,t=this[0].selectionEnd):document.selection&&document.selection.createRange&&(n=document.selection.createRange(),e=0-n.duplicate().moveStart("character",-1e5),t=e+n.text.length),{begin:e,end:t})},unmask:function(){return this.trigger("unmask")},mask:function(a,o){var c,l,s,u,f,h;return!a&&this.length>0?(c=e(this[0]),c.data(e.mask.dataName)()):(o=e.extend({placeholder:e.mask.placeholder,completed:null},o),l=e.mask.definitions,s=[],u=h=a.length,f=null,e.each(a.split(""),function(e,t){"?"==t?(h--,u=e):l[t]?(s.push(RegExp(l[t])),null===f&&(f=s.length-1)):s.push(null)}),this.trigger("unmask").each(function(){function c(e){for(;h>++e&&!s[e];);return e}function d(e){for(;--e>=0&&!s[e];);return e}function m(e,t){var n,a;if(!(0>e)){for(n=e,a=c(t);h>n;n++)if(s[n]){if(!(h>a&&s[n].test(R[a])))break;R[n]=R[a],R[a]=o.placeholder,a=c(a)}b(),x.caret(Math.max(f,e))}}function p(e){var t,n,a,r;for(t=e,n=o.placeholder;h>t;t++)if(s[t]){if(a=c(t),r=R[t],R[t]=n,!(h>a&&s[a].test(r)))break;n=r}}function g(e){var t,n,a,i=e.which;8===i||46===i||r&&127===i?(t=x.caret(),n=t.begin,a=t.end,0==a-n&&(n=46!==i?d(n):a=c(n-1),a=46===i?c(a):a),k(n,a),m(n,a-1),e.preventDefault()):27==i&&(x.val(S),x.caret(0,y()),e.preventDefault())}function v(t){var n,a,r,l=t.which,u=x.caret();t.ctrlKey||t.altKey||t.metaKey||32>l||l&&(0!=u.end-u.begin&&(k(u.begin,u.end),m(u.begin,u.end-1)),n=c(u.begin-1),h>n&&(a=String.fromCharCode(l),s[n].test(a)&&(p(n),R[n]=a,b(),r=c(n),i?setTimeout(e.proxy(e.fn.caret,x,r),0):x.caret(r),o.completed&&r>=h&&o.completed.call(x))),t.preventDefault())}function k(e,t){var n;for(n=e;t>n&&h>n;n++)s[n]&&(R[n]=o.placeholder)}function b(){x.val(R.join(""))}function y(e){var t,n,a=x.val(),r=-1;for(t=0,pos=0;h>t;t++)if(s[t]){for(R[t]=o.placeholder;pos++<a.length;)if(n=a.charAt(pos-1),s[t].test(n)){R[t]=n,r=t;break}if(pos>a.length)break}else R[t]===a.charAt(pos)&&t!==u&&(pos++,r=t);return e?b():u>r+1?(x.val(""),k(0,h)):(b(),x.val(x.val().substring(0,r+1))),u?t:f}var x=e(this),R=e.map(a.split(""),function(e){return"?"!=e?l[e]?o.placeholder:e:void 0}),S=x.val();x.data(e.mask.dataName,function(){return e.map(R,function(e,t){return s[t]&&e!=o.placeholder?e:null}).join("")}),x.attr("readonly")||x.one("unmask",function(){x.unbind(".mask").removeData(e.mask.dataName)}).bind("focus.mask",function(){clearTimeout(t);var e;S=x.val(),e=y(),t=setTimeout(function(){b(),e==a.length?x.caret(0,e):x.caret(e)},10)}).bind("blur.mask",function(){y(),x.val()!=S&&x.change()}).bind("keydown.mask",g).bind("keypress.mask",v).bind(n,function(){setTimeout(function(){var e=y(!0);x.caret(e),o.completed&&e==x.val().length&&o.completed.call(x)},0)}),y()}))}})}(jQuery);
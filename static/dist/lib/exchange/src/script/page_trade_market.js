define(function(require,exports){function e(e){var t={},a={};a.priceNew=e.p_new,a.priceOpen=e.p_open,a.priceHigh=e.p_high,a.priceLow=e.p_low,a.priceLast=e.p_last,a.level=e.level,a.totalAmount=e.amount,t.data_price=a;var n=[],r=[],s=[],o=0,c=0,i=0,u=0,p=e.buys.length;for(sell_len=e.buys.length;i<p;i++)c+=1e10*e.buys[i].amount,e.buys[i]&&n.push([l(e.buys[i].price,3),l(e.buys[i].amount,4),l(c/1e10,4)]);for(;u<sell_len;u++)o+=1e10*e.sells[u].amount,e.sells[u]&&r.push([l(e.sells[u].price,3),l(e.sells[u].amount,4),l(o/1e10,4)]);for(var i=0;i<10;i++){var d;d="bid"==e.trades[i].en_type?1:4,e.trades[i].price&&s.push([d,e.trades[i].time,l(e.trades[i].amount,4),l(e.trades[i].price,3)])}return t.buy=n,t.sel=r,t.tra=s,t}function t(e,t){var a=k["marketDetail"+t](g);w.msg(a.msg),w.reg(a.msgType,function(e){if(M<2&&(M+=1),e.payload.symbolId==g){var e=s(e.payload);r(e.buy,e.sel)}})}function a(e,t){function a(){var e=r.pop(),a=t?~~e[0]:Math.ceil(e[0]),s=r.length;for(n[a]={amt:e[1],price:a};s--;)n[a].amt+=1*r[s][1]}if(!e.length)return[];for(var n={},r=[],s=[],o=0,c=e.length,l=t?~~e[0][0]:Math.ceil(e[0][0]),i=t?-1*N:1*N,u=0;u<c;u++)_this=e[u][0],t&&e[u][0]-l<i+1&&(a(),r=[],l=~~e[u][0]),!t&&e[u][0]-l>i-1&&(a(),r=[],l=Math.ceil(e[u][0])),r.push(e[u]);r.length&&a();for(var p in n)s.push([n[p].price,n[p].amt]);s=s.sort(function(e,a){return t?a[0]-e[0]:e[0]-a[0]});for(var u=0,c=s.length;u<c;u++)o+=s[u][1],s[u][2]=o;return s}function n(e,t){marketdata={buy:e,sel:t}}function r(e,t){var r=e,s=t;n(r,s),r=N?a(r,1):r,s=N?a(s,0):s,1*(r[0]?r[0][0]:0),s[0]&&s[0][0],x.buy5=r.slice(0,5),x.sell5=s.slice(0,5),0==x.newprice&&(x.newprice=e[0][0]),B.innerHTML=i(q,{buy:r.slice(0,5),sel:s.slice(0,5),price:x.newprice,font_color:x.font_color,money_symbol:c})}function s(e){for(var t=[],a=[],n=0,r=0,s=0,c=e.bids.amount.length;s<c;s++)r+=1e10*e.bids.amount[s],e.bids.price[s]&&t.push([l(e.bids.price[s],3),l(e.bids.amount[s],4),l(r/1e10,4)]);for(s=0,c=e.asks.amount.length;s<c;s++)n+=1e10*e.asks.amount[s],e.asks.price[s]&&a.push([l(e.asks.price[s],3),l(e.asks.amount[s],4),l(n/1e10,4)]);return o(e),{buy:t,sel:a}}function o(e){var t=l(e.priceNew,3),a=x.font_color;t>x.newprice?a="font_up":t<x.newprice&&(a="font_down"),x.newprice=t,x.font_color=a;var n="";n="cny"==v?"￥":"$";var r;r=n+t+" | "+m,$(document).attr("title",r)}var c,l=require("./module_number"),i=require("./module_tmpl"),u=require("./module_connect"),p=require("./module_socket_api"),d=(require("./module_socket_io"),require("./module_ajax")),m=$(document).attr("title"),_=0,f=$("input[name='coin_type']").val();switch(f){case"cny_btc":var h="btc",v="cny",b="staticmarket";c="￥";break;case"cny_ltc":var h="ltc",v="cny",b="staticmarket";c="￥";break;case"usd_btc":var h="btc",v="usd",b="usdmarket";c="$";break;case"usd_ltc":var h="ltc",v="usd",b="usdmarket";c="$";break;default:var h="btc",v="cny",b="staticmarket";c="￥"}140!=window.RUN_MODE||"usd_btc"!=f&&"usd_ltc"!=f||($_ws_hq_url=$_ws_hq_url_usd);var y,g=h+v,k=p(),w=u($_ws_hq_url),M=0,N="",j="https:"==document.location.protocol?"https":"http",A=j+"://"+AJAX_API_DOMAIN+"/"+b+"/detail_"+h+".js";y=new d({data:{},url:A,refresh:1e3,datatype:"jsonp",jsonp:"callback",jsonpcallback:"view_detail_"+h},function(t){t.code;if("success"==t.code){var a=t.data,n=e(a);o(n.data_price),r(n.buy,n.sel)}}),w.conn.on("message",function(){y.Stop()}),w.conn.on("disconnect",function(){y.Play()});var E=$("#change_depth"),I=E.find("dt b"),L=E.find("dd p");E.hover(function(){E.addClass("hover")},function(){E.removeClass("hover")}),L.on("click",function(){var e=$(this),a=1*e.text();I.text(a);var n=k["marketDetail"+_](g);w.msg(n.unmsg),w.clearmsg(),_=a,t("market",_),E.removeClass("hover")});var T=document.getElementById("market"),B=(T.getElementsByTagName("div"),document.getElementById("market_depth")),D=T.getElementsByTagName("script"),q=D[0].innerHTML,x=x||{acc:{},buy5:[],sell5:[],autoRelease:1,order:[],orderList:0,enable_coin:0,limit:[0,0],newprice:0,font_color:"font_up",holdStatus:0};t("market",_)});
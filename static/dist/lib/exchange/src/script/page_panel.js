define(function(require,exports){function a(a,t){var e=document.getElementById(a)||document.getElementById("view_"+a);(ta[a]||document.getElementById("tmp_"+a)||e.getElementsByTagName("script")[0])&&(ta[a]=ta[a]?ta[a]:document.getElementById("tmp_"+a)?document.getElementById("tmp_"+a).innerHTML:e.getElementsByTagName("script")[0].innerHTML,e.innerHTML=D(ta[a],t))}function t(a){q=a?"PlaceMarketOrder":"PlaceOrder",j.trigger("__OrderType",[a])}function e(a,t){"PlaceOrder"===a?(j["#panel_wrap"].hasClass("market_price")&&j["#panel_wrap"].removeClass("market_price"),j["#panel_wrap"].find(".trade_amount").show()):"PlaceMarketOrder"===a&&(!j["#panel_wrap"].hasClass("market_price")&&j["#panel_wrap"].addClass("market_price"),j["#panel_wrap"].find(".trade_amount").hide()),j.order_type.val(q),ea.find("a").eq(t).addClass("cur").siblings().removeClass("cur")}function n(a){if("HBForm"===a.Type)return a;var t=$(a);return t.find("[name]").each(function(a,e){var n=$(e),r=n.attr("name");t[r]=n,t[r].Value=n.val()}),t.Type="HBForm",t}function r(a,t){return/\.$/.test(t)?k(t):"price"==a?k(t,3):k(t,4)}function l(a){var t=!1;if(o()){var e=a.find(".trade_pwd_group");e.is(":hidden")&&(e.show(),t=!0),$(".trade_pwd_group").each(function(){var a=$(this);a.is(":hidden")&&a.show()})}return t}function o(){var a=F.Cookie("trade_pwd_on"),t=F.Cookie("trade_pwd_time");return"0"!=a&&("1"==a||(!t||"0"==t))}function _(a){function t(a,t,e,l,o){var _=[];return"buy"===n?(_[0]=e?x.Div(r?t[0]:a[0],e):0,_[0]=_[0]<l[0]?_[0]:l[0],_[1]=r?t[0]:a[0],_[1]=_[1]<o[0]?_[1]:o[0]):(_[2]=r?t[1]:a[1],_[2]=_[2]<l[1]?_[2]:l[1],_[3]=r?t[1]<o[1]?t[1]:o[1]:a[1]<o[1]?a[1]:o[1]),_}var e=a||{},n=e.trade_type,r=e.loan_type,l=e.price,o=e.available,_=x.Add(e.loan_enable,o),c=e.un_price,d=e.un_amount,i=[];switch(R){case"cny_btc":i=t([c||o,d||o],[_,_],l,[h.BuyBtc,h.SellBtc],[h.BuyBtcMp,h.SellBtcMp]),void 0!==i[0]&&(h.buyMaxAmount=i[0]),void 0!==i[1]&&(h.buyMaxAmountMp=i[1]),void 0!==i[2]&&(h.sellMaxAmount=i[2]),void 0!==i[3]&&(h.sellMaxAmountMp=i[3]);break;case"cny_ltc":i=t([c||o,d||o],[_,_],l,[h.BuyLtc,h.SellLtc],[h.BuyLtcMp,h.SellLtcMp]),void 0!==i[0]&&(h.buyMaxAmount=i[0]),void 0!==i[1]&&(h.buyMaxAmountMp=i[1]),void 0!==i[2]&&(h.sellMaxAmount=i[2]),void 0!==i[3]&&(h.sellMaxAmountMp=i[3]);break;case"usd_btc":i=t([c||o,d||o],[_,_],l,[h.BuyBtc,h.SellBtc],[h.BuyBtcMp,h.SellBtcMp]),void 0!==i[0]&&(h.buyMaxAmount=i[0]),void 0!==i[1]&&(h.buyMaxAmountMp=i[1]),void 0!==i[2]&&(h.sellMaxAmount=i[2]),void 0!==i[3]&&(h.sellMaxAmountMp=i[3]);break;case"usd_ltc":i=t([c||o,d||o],[_,_],l,[h.BuyLtc,h.SellLtc],[h.BuyLtcMp,h.SellLtcMp]),void 0!==i[0]&&(h.buyMaxAmount=i[0]),void 0!==i[1]&&(h.buyMaxAmountMp=i[1]),void 0!==i[2]&&(h.sellMaxAmount=i[2]),void 0!==i[3]&&(h.sellMaxAmountMp=i[3])}}function c(a,t,e){var n;return"PlaceOrder"===q?t&&a?(n=x.Mul(1*t,1*a),e&&e.html(k(n,3)).attr("actual",n)):(n=0,e&&e.html("0.00")):n=void 0!==a?a:t,n}function d(a,t,e,n,r){var l=0;return l="buy"===e?x.Sub(a[0],t)>0?x.Sub(a[0],t):0:x.Sub(a[1],t)>0?x.Sub(a[1],t):0,l=l>0&&l<M[r]?M[r]:l,"buy"===e?n&&n.html(b(k(l),"currency")).attr("data-amount",b(k(l),"currency")):n&&n.html(b(k(l),"coin")).attr("data-amount",b(k(l),"coin")),l}function i(a,t){return/\.$/.test(a)?k(a):k(a,t)}function u(){var a=this;a.FormatVal=function(t){var e=a.val();return e<0&&(e=0,a.val(e)),""==e||("price"==t?/^(([0-9]{1}\d*)|([0]{1}))(\.(\d){0,2})?$/:/^(([0-9]{1}\d*)|([0]{1}))(\.(\d){0,4})?$/).test(e)||(e=i(1*e,"price"==t?2:4),a.val(e)),1*e}}function s(a,t,e,l){var o=$(t),_=o.find(".range_ratio"),c=n(o.parents("form")),d=c.amount,i=c.market_amount,u=(c.transaction_amount,c.market_transaction_amount),s=a/100;s?_.show():_.hide(),_.css({left:a+"%"}),"PlaceOrder"===q||"edit"===l?"buy"===e?d.val(r("amount",x.Mul(h.buyMaxAmount,s))).change().trigger("__Focus"):d.val(r("amount",x.Mul(h.sellMaxAmount,s))).change().trigger("__Focus"):"buy"===e?u.val(r("price",x.Mul(h.buyMaxAmountMp,s))).change().trigger("__Focus"):i.val(r("amount",x.Mul(h.sellMaxAmountMp,s))).change().trigger("__Focus")}function m(a,t,e){var n=e&&t?e/t*100:0;a.Update(n)}function p(a,t,e,n){"buy"===a?(t&&t.html(k(h.buyMaxAmount,4)),e&&e.attr("data-max",k(h.buyMaxAmount,4)),n&&n.attr("data-max",k(h.buyMaxAmountMp,4))):(t&&t.html(k(h.sellMaxAmount,4)),e&&e.attr("data-max",k(h.sellMaxAmount,4)),n&&n.attr("data-max",k(h.sellMaxAmountMp,4)))}function f(a,t){var e=n(a),r=e.price,l=e.amount,o=e.find(".transaction_amount"),_=e.market_transaction_amount,c=e.market_amount,d=e.find(".loan_amount"),i=e.find(".trade_msg"),u=e.trade_pwd,s=e.loan_type,m=e.attr("data-form-type");e.find(":submit");"all"===t&&r.val(""),l&&l.val("").change(),o&&o.html("0.00"),d&&d.html("0.00"),_&&_.val("").change(),c&&c.val("").change(),i&&i.html(""),u&&u.val("").removeClass("input_text_red"),s&&s.prop("checked",!1).attr("data-loan-state",0).trigger("__Update"),e.trigger_price&&e.trigger_price.val(""),e.order_price&&e.order_price.val(""),e.order_amount&&e.order_amount.val(""),"entrust"!==W&&"edit"!=m&&(na.Reset(),ra.Reset()),"edit"==m&&(la.Reset(),oa.Reset())}function y(){var a=[];return $.each(this,function(t,e){var n=$(this);a.push(n);var r=n.find(".mod_bd"),l=n.find(".trigger_fold"),o=l.attr("data-text")?l.attr("data-text").split(","):"",_=l.attr("data-state");n.Close=function(){r.hide(),l.attr("data-state","close").html(o[1]).removeClass("open"),_="close",F.Cookie("mod_fold"+t,0,{path:"/",expires:36500,domain:COOKIE_DOMAIN})},n.Open=function(){r.show(),l.attr("data-state","open").html(o[0]).addClass("open"),_="open",F.Cookie("mod_fold"+t,1,{path:"/",expires:36500,domain:COOKIE_DOMAIN})},n.Toggle=function(){"open"===_?n.Close():n.Open()},l.on("click",function(){n.Toggle()})}),a}function b(a,t){var e;return"currency"==t&&(e=Math.floor(100*a+.9)/100),"coin"==t&&(e=Math.floor(1e4*a+.9)/1e4),e}var g,v,h,A,M,x=(require("./page_common"),require("./module_accurate")),k=require("./module_number"),w=require("./module_validator"),B=require("./module_range"),C=require("./module_table"),L=require("./module_order"),F=require("./module_cookie"),O=require("./module_check_all"),T=require("./module_dialog"),U=require("./module_inform"),E=require("./module_md5"),S=require("./module_hb_extend"),V=require("./module_window"),N=require("./module_ajax"),I=require("./module_switch"),H=require("./module_md5"),P=require("./module_this_jack"),D=require("./module_tmpl"),G=require("./module_time"),q="PlaceOrder",R="cny_btc",j=$(document);window.mNum=k,window.UTT=G,h={buyMaxAmount:0,sellMaxAmount:0,buyMaxAmountMp:0,sellMaxAmountMp:0,BuyBtc:1e3,SellBtc:1e3,BuyLtc:2e4,SellLtc:2e4,BuyUsdBtc:1e3,SellUsdBtc:1e3,BuyUsdLtc:2e4,SellUsdLtc:2e4,BuyBtcMp:1e6,SellBtcMp:1e3,BuyLtcMp:1e6,SellLtcMp:2e4,BuyUsdBtcMp:1e5,SellUsdBtcMp:1e3,BuyUsdLtcMp:1e6,SellUsdLtcMp:2e4,LoanCny:100,LoanCnyBtc:1,LoanCnyLtc:100,LoanUsd:100,LoanUsdBtc:1},A={cny_loan_enable:0,cny_btc_loan_enable:0,cny_ltc_loan_enable:0,usd_usd_loan_enable:0,usd_btc_loan_enable:0,cny_loan_total:0,cny_btc_loan_total:0,cny_ltc_loan_total:0,usd_loan_total:0,usd_btc_loan_total:0},M={cny_cny:100,cny_btc:.1,cny_ltc:1,usd_usd:50,usd_btc:.1,usd_ltc:1},window.loanLimit=A,R=document.getElementsByName("coin_type")[0].value,g=R.split("_"),v=document.getElementsByName("_csrf")[0]&&document.getElementsByName("_csrf")[0].value,j["#panel_wrap"]=$("#panel_wrap"),j["#order_list"]=$("#order_list"),j["#history_list"]=$("#history_list"),j["#mod_order"]=$("#mod_order"),j["#mod_history"]=$("#mod_history"),j["#depth_top"]=$("#depth_top"),j[".form_trade"]=$(".form_trade"),j["#cny_cny_a_panel"]=$("#cny_cny_a_panel"),j["#cny_btc_a_panel"]=$("#cny_btc_a_panel"),j["#usd_usd_a_panel"]=$("#usd_usd_a_panel"),j["#usd_btc_a_panel"]=$("#usd_btc_a_panel"),j["#cny_ltc_a_panel"]=$("#cny_ltc_a_panel"),j["#cny_cny_l_panel"]=$("#cny_cny_l_panel"),j["#cny_btc_l_panel"]=$("#cny_btc_l_panel"),j["#cny_ltc_l_panel"]=$("#cny_ltc_l_panel"),j["#usd_usd_l_panel"]=$("#usd_usd_l_panel"),j["#usd_btc_l_panel"]=$("#usd_btc_l_panel"),j["#market"]=$("#market"),j.order_type=j["#panel_wrap"].find('[name="order_type"]'),j.coin_type=$('[name="coin_type"]').eq(0);var J=window.HUOBI.AJAX.GetBalance||null,X=j["#panel_wrap"].length>0?L.GetOrder({temp:"order_list_tmp",wrap:"order_list",coin_type:R,is_history:0,damp:!0},function(){K&&K.Fire()}):null,K=j["#panel_wrap"].length>0?L.GetOrder({temp:"history_list_tmp",wrap:"history_list",coin_type:R,is_history:1,delay:0}):null,z=function(a,t){if(!(j["#panel_wrap"].length<=0))return new N({url:"/loan/index.php",data:{a:"get_loan_available_multi",loan_types:a},init:t},function(a){switch(a.code){case"loading":case"error":break;case"success":var t,e=a.data;0===e.code&&e.ext&&($.each(e.ext,function(a,e){switch(t=1*e.enable,a){case"cny_cny":A.cny_loan_enable=t,A.cny_loan_total=x.Add(t,HUOBI.BALANCE.cny_available||0);break;case"cny_btc":A.cny_btc_loan_enable=t,A.cny_btc_loan_total=x.Add(t,HUOBI.BALANCE.cny_btc_available||0);break;case"cny_ltc":A.cny_ltc_loan_enable=t,A.cny_ltc_loan_total=x.Add(t,HUOBI.BALANCE.cny_ltc_available||0);break;case"usd_usd":A.usd_loan_enable=t,A.usd_loan_total=x.Add(t,HUOBI.BALANCE.usd_available||0);break;case"usd_btc":A.usd_btc_loan_enable=t,A.usd_btc_loan_total=x.Add(t,HUOBI.BALANCE.usd_btc_available||0)}}),j.trigger("__LoanUpdate"))}})},Q=function(a,t){var e=a||{},n=e.amount||0,r=e.loan_type;if(!(n<=0))return new N({url:"/loan/index.php",data:{a:"do_loan",loan_type:r,currency:n,_csrf:v,check:"on"},type:"POST",random:!1},function(a){t&&t(a)})};S({name:"AJAX",value:{GetOrder:X}}),S({name:"AJAX",value:{GetHistory:K}}),S({name:"DOM",value:j});var W=j.coin_type.attr("data-page"),Y=z("cny_cny,cny_btc","cny_btc"==R),Z=z("cny_cny,cny_ltc","cny_ltc"==R),aa=z("usd_usd,usd_btc","usd_btc"==R);j["#market"].length>0&&require("./page_trade_market");j["#market"].on("click","li",function(){function a(){l.val(r).addClass("focus"),setTimeout(function(){l.removeClass("focus")},300)}var e=$(this),n=e.attr("data-price")?e.attr("data-price").split(","):[],r=n[0],l=$(".panel_wrap").find(".form_trade").find('[name="price"]');"PlaceOrder"===q?a():(t(0),a())});var ta={};I({Switch:".switch"});var ea=j["#panel_wrap"].find(".wrap_tabs");ea.on("click","a",function(){return t($(this).index()),!1});w({forms:j[".form_trade"],tip:".trade_msg",beforeSend:function(a){j.trigger("__TradeFormBeforeSend",[a])},beforeValidation:function(a){j.trigger("__TradeFormValidation",[a])},beforeSubmit:function(a){var t=n(a),e=t.loan_type,r=e&&e.data("loan-type"),l=e&&1*e.attr("data-loan-state"),o=1*t.find(".loan_amount").attr("data-amount");if(o>0&&e.prop("checked"))switch(l){case 0:return j.trigger("__GetLoan",[t,r,o]),!1;case 1:return!1;case 2:break;case 3:default:return!1}j.trigger("__TradeFormBeforeSubmit",[t])},postData:function(a){var t=[];return console.log(a),$.each(a,function(a,e){var n="";""!=$.trim(e.value)&&(n=H.hbmd5($.trim(e.value))),"trade_pwd"!=e.name?t.push(e):t.push({name:"trade_pwd",value:n})}),t},callback:function(a,t){j.trigger("__TradeFormCallback",[t,a])},ajaxError:function(a){j.trigger("__TradeFormError",[a])}});var na=new B({range:".range_buy",step:1,point:4,slide:function(a,t){s(a,t,"buy")}}),ra=new B({range:".range_sell",step:1,point:4,slide:function(a,t){s(a,t,"sell")}}),la=new B({range:".range_edit_buy",step:1,point:4,slide:function(a,t){s(a,t,"buy","edit")}}),oa=new B({range:".range_edit_sell",step:1,point:4,slide:function(a,t){s(a,t,"sell","edit")}});j["#order_list"].on("click",".cancel",function(){var a=$(this),t=a.attr("data-ids"),e=a.parents("tr"),n=$(".check_all");return!(1*a.attr("data-init"))&&(a.attr("data-init",1),L.CancelOrder({coin_type:R,id:t},function(t){"loading"==t.code?(e.addClass("cancel"),X&&X.Stop()):"error"==t.code?(e.hasClass("cancel")&&e.removeClass("cancel"),a.attr("data-init",0),U({msg:window.Texts&&Texts.NetworkError,type:"error",delay:1800}),X&&X.Play()):(0===t.code?(e.next(".hidden_info").remove(),e.remove(),n.prop("checked",!1),"entrust"==W&&V.reload(1),j.trigger("__OrderCancel")):(U({msg:t.msg,type:"error"}),a.attr("data-init",0),e.hasClass("cancel")&&e.removeClass("cancel")),X&&X.Play())}),!1)});var _a=[],ca=$(".check_info"),da=$("#orderCancel");O({box:".order_wrap"},function(a){var t=a||[];ca.html(t.length),_a=t}),da.click(function(){var a,t=$(this),e=$(".check_all"),n=t.attr("data-msg-null"),r=j["#order_list"].find("tr");return!(1*t.attr("data-init"))&&(_a.length<=0?U({msg:n,type:"error"}):L.CancelOrder({coin_type:R,id:_a},function(n){"loading"==n.code?(t.attr("data-init",1),$.each(_a,function(t,e){a=$('[value="'+e+'"]').parents("tr"),a.addClass("cancel")})):"error"==n.code?(t.attr("data-init",0),r.hasClass("cancel")&&r.removeClass("cancel"),U({msg:window.Texts&&Texts.NetworkError,type:"error",delay:1800})):(t.attr("data-init",0),0==n.code?(e.prop("checked",!1),a=$("tr.cancel"),a.next(".hidden_info").remove(),a.remove(),_a=[],"entrust"==W&&V.reload(1),j.trigger("__OrderCancel")):(U({msg:n.msg,type:"error"}),r.hasClass("cancel")&&r.removeClass("cancel")))}),!1)});var ia=P(y,$(".mod_fold"));C({table:".multi_table"},function(a,t,e){var n=t.attr("data-ids"),r=t.attr("data-type");"show"===e&&L.GetDetails({coin_type:R,id:n,type:r,temp:"details_tmp",wrap:a[0]})});var ua=new T({dialog:".edit_dialog"});j["#order_list"].on("click",".edit",function(){var a=$(this),t=a.parents("tr"),e=a.attr("data-ids"),r=1*$.trim(t.find(".order_price").html()),l=1*$.trim(t.find(".order_amount").html()),o=1*$.trim(t.find(".order_unsettled").html()),_=a.attr("data-type"),c=x.Mul(r,o);return ua.Show(function(a){var t,d,i,u,s,m,p,f,y=a.find(".trade_msg"),b=a.find(".input_text_red"),g=a.find("form");t=n("buy"===_?a.find(".form_buy_edit"):a.find(".form_sell_edit")),d=t.id,i=t.price,u=t.amount,s=t.find(".un_price"),m=t.find(".un_amount"),p=1*t.find(".available").attr("data-flaunt"),f=t.find(".transaction_amount"),t._DTA=f,g.hide(),t.show(),d.val(e),i.val(k(r,3)),u.val(k(o,4)),s&&s.html(x.Add(c,p)).attr("data-unsettled",c),m&&m.html(x.Add(o,p)).attr("data-unsettled",o),y.html(""),b.removeClass("input_text_red"),j.trigger("__FormChange",[t,r,l,"edit"+_]),j.trigger("__FormMax",[t,{trade_type:_,available:p,price:r,un_price:"buy"===_&&x.Add(c,p),un_amount:"sell"===_&&x.Add(o,p)},"edit"+_]),la.Reset(),oa.Reset()}),!1});var sa,ma=$(".plan_panel").length,pa=ma&&new N({url:"/trade/get_trade_plan_list",datatype:"json",refresh:3e3,data:{symbol:g[1]+g[0],status:0}},function(t){switch(t.code){case"loading":break;case"error":a("plan_order_list",{network:!1});break;case"success":if(t.data.network=!0,!t.data.data||!t.data.data.list||t.data.data.list.length<1)pa.Stop(),console.log("PlanList Stop");else{var e=E.md5(JSON.stringify(t.data.data.list));e!==sa&&(X&&X.Fire(),sa=e)}a("plan_order_list",t.data)}}),fa=function(a,t){var e=a,n=e.id;N({url:"/trade/trade_plan_cancel",data:{id:n}},function(a){switch(a.code){case"loading":case"error":t&&t(a);break;case"success":t&&t(a.data)}})},ya=$("#plan_dialog"),ba=ma&&new T({dialog:ya},function(a,t){"close"===t&&f(a.find("form"))});!function(){function a(a){var t,n,r,c;return _=1*e.trigger_price.val(),o=1*e.trade_type.val(),l=1*e.order_amount.val(),r=a.attr("data-msg").split(","),l&&l<.1?(n=.01*_,c=["101%","99%"]):(n=.1*_,c=["110%","90%"]),1===o&&(t=k(_+n,3),a.attr({"data-max":t,"data-min":.01,"data-msg-error":r[0]+","+r[1]+r[3]+","+r[2]+r[4].replace("**",c[0])})),2===o&&(t=k(_-n),a.attr({"data-min":t,"data-max":1e5,"data-msg-error":r[0]+","+r[1]+r[4].replace("**",c[1])+","+r[2]+r[3]})),t}function t(){1==o?c.addClass("btn_buy").removeClass("btn_sell").text(d[0]):2==o&&c.addClass("btn_sell").removeClass("btn_buy").text(d[1])}if(ma){var e=n(ya.find(".form_trade")),r=e.order_price.Value,l=e.order_amount.Value,o=1*e.trade_type.Value,_=1*e.trigger_price.Value,c=e.find(":submit"),d=c.data("msg-submit").split(","),i=$("#plan_order_list");e._DTA=e.find(".transaction_amount"),P(u,e.order_price),P(u,e.order_amount),P(u,e.trigger_price),$("#plan_panel").click(function(){ba.Show()}),e.trigger_price.on("keyup",function(){e.trigger_price.FormatVal("price")}).on("change",function(){a(e.order_price)}).blur(function(){0==e.trigger_price.val()&&e.trigger_price.val("")}),e.order_price.on("keyup",function(){r=e.order_price.FormatVal("price"),j.trigger("__FormChange",[e,r,l])}).on("change",function(){a(e.order_price)}).blur(function(){0==e.order_price.val()&&e.order_price.val("")}),e.order_amount.on("keyup",function(){l=e.order_amount.FormatVal("amount"),j.trigger("__FormChange",[e,r,l])}).on("change",function(){a(e.order_price)}).blur(function(){0==e.order_amount.val()&&e.order_amount.val("")}),e.trade_type.on("change",function(){o=$(this).val(),t(),a(e.order_price)}),t(),i.on("click",".cancel",function(){var a=$(this),t=$(this).attr("data-ids"),e=a.parents("tr");return fa({id:t},function(a){"loading"==a.code?e.addClass("cancel"):"error"==a.code?(e.hasClass("cancel")&&e.removeClass("cancel"),U({msg:window.Texts&&Texts.NetworkError,type:"error",delay:1800})):0===a.code?(e.remove(),pa.Fire()):(U({msg:a.msg,type:"error"}),e.hasClass("cancel")&&e.removeClass("cancel"))}),!1})}}(),function(a){a.each(function(){var a,t,e,r,l,o,_,c,d=n($(this)),i=d.attr("data-form-type"),s=d.attr("data-trade-type"),p=d.price,f=d.amount,y=d.find(".transaction_amount"),b=d.market_amount,g=d.market_transaction_amount,v=d.find(".max_amount"),A=v.parent(),M=v.find("b"),x=d.loan_type,k=d.find(".loan_amount_wrap"),w=d.find(".trade_amount"),B=d.find(".loan_amount"),C=(d.find("[data-ratio]"),d.find(".available")),L=d.find(".un_price"),F=d.find(".un_amount"),O=d.find(".loan_available"),T=d.find(".range_wrap"),U=d.find(".credit_bar"),E=x&&x.attr("data-loan-type");d._DMax=v,d._DMaxB=M,d._type=s,d._DLA=B,d._DTA=y,d._VLT=E,P(u,p),P(u,f),P(u,g),P(u,b),p&&p.on("keyup",function(){t=1*p.val(),e=1*f.val(),c=1*O.attr("data-enable"),p.FormatVal("price"),"buy"===s&&(o=1*L.html(),_=1*F.html(),j.trigger("__FormMax",[d,{trade_type:s,loan_type:x&&x.prop("checked"),price:1*t,available:1*C.attr("data-flaunt"),un_price:o,un_amount:_,loan_enable:c},"price keyup"])),f.trigger("change")}).blur(function(){0==t&&p.val("")}),f&&f.on("keyup",function(){t=1*p.val(),e=1*f.val(),d._VAV=1*C.attr("data-flaunt"),f.FormatVal("amount"),"buy"===s?"edit"==i?m(la,h.buyMaxAmount,e):m(na,h.buyMaxAmount,e):"edit"==i?m(oa,h.sellMaxAmount,e):m(ra,h.sellMaxAmount,e),t=1*p.val(),e=1*f.val(),j.trigger("__FormChange",[d,t,e,"amount keyup"])}).on("focus",function(){o=1*L.html(),_=1*F.html(),t=p.val(),c=1*O.attr("data-enable"),!d._AM&&j.trigger("__FormMax",[d,{trade_type:s,loan_type:x&&x.prop("checked"),price:1*t,available:1*C.attr("data-flaunt"),un_price:o,un_amount:_,loan_enable:c},"amount focus"]),A.addClass("focus")}).blur(function(){A.removeClass("focus"),0==e&&f.val("")}).change(function(){t=p.val(),e=f.val(),d._VAV=1*C.attr("data-flaunt"),j.trigger("__FormChange",[d,t,e,"amount change"])}),g&&g.on("keyup",function(){l=g.val(),g.FormatVal("price"),d._VAV=1*C.attr("data-flaunt"),"edit"!==i&&m(na,h.buyMaxAmountMp,l),j.trigger("__FormChange",[d,l,e,"market_transaction_amount keyup"])}).change(function(){l=1*g.val(),d._VAV=1*C.attr("data-flaunt"),j.trigger("__FormChange",[d,l,e,"market_transaction_amount change"])}),b&&b.on("keyup",function(){r=b.val(),b.FormatVal("amount"),d._VAV=1*C.attr("data-flaunt"),"edit"!==i&&m(ra,h.sellMaxAmountMp,r),j.trigger("__FormChange",[d,t,r,"market_amount keyup"])}).change(function(){r=b.val(),d._VAV=1*C.attr("data-flaunt"),j.trigger("__FormChange",[d,t,r,"market_amount change"])}),x&&x.change(function(){o=1*L.html(),_=1*F.html(),a=x.prop("checked"),c=1*O.attr("data-enable"),a&&j.trigger("__UpLoan",[R,"loan_type change"]),j.trigger("__FormMax",[d,{trade_type:s,loan_type:a,price:1*t,available:1*C.attr("data-flaunt"),un_price:o,un_amount:_,loan_enable:c},"loan change"]),d._VAV=1*C.attr("data-flaunt"),"buy"===s?"PlaceOrder"===q?"edit"!==i&&m(na,h.buyMaxAmount,e):"edit"!==i&&m(na,h.buyMaxAmountMp,e):"PlaceOrder"===q?"edit"!==i&&m(ra,h.sellMaxAmount,e):"edit"!==i&&m(na,h.sellMaxAmountMp,e),a?(k.show(),w.show(),U.removeClass("disabled")):(k.hide(),"PlaceMarketOrder"===q&&w.hide(),U.addClass("disabled"))}),T.focus(function(){A.addClass("focus")}).blur(function(){A.removeClass("focus")}).on("focus ",function(){o=1*L.html(),_=1*F.html(),t=p.val(),c=1*O.attr("data-enable"),j.trigger("__FormMax",[d,{trade_type:s,loan_type:x&&x.prop("checked"),price:1*t,available:1*C.attr("data-flaunt"),un_price:o,un_amount:_,loan_enable:c}," range slide"])}),d.on("__FormActive",function(a){p&&(o=1*L.html(),_=1*F.html(),t=p.val(),c=1*O.attr("data-enable"),j.trigger("__FormMax",[d,{trade_type:s,loan_type:x&&x.prop("checked"),price:1*t,available:1*C.attr("data-flaunt"),un_price:o,un_amount:_,loan_enable:c},"Form Active"]))})})}(j[".form_trade"]),j.on("DoDocHidden",function(){HUOBI.GLOBAL.docHidden?X&&X.Stop():X&&X.Play()}).on("__GetBalance",function(a){var t=k(HUOBI.BALANCE.cny_available,2).split("."),e=k(HUOBI.BALANCE.cny_btc_available,3).split("."),n=k(HUOBI.BALANCE.cny_ltc_available,4).split("."),r=k(HUOBI.BALANCE.usd_available,2).split("."),l=k(HUOBI.BALANCE.usd_btc_available,4).split(".");j["#cny_cny_a_panel"].attr("data-flaunt",HUOBI.BALANCE.cny_available).html("<b>"+t[0]+"</b>."+t[1]),j["#cny_btc_a_panel"].attr("data-flaunt",HUOBI.BALANCE.cny_btc_available).html("<b>"+e[0]+"</b>."+e[1]),j["#cny_ltc_a_panel"].attr("data-flaunt",HUOBI.BALANCE.cny_ltc_available).html("<b>"+n[0]+"</b>."+n[1]),j["#usd_usd_a_panel"].attr("data-flaunt",HUOBI.BALANCE.usd_available).html("<b>"+r[0]+"</b>."+r[1]),j["#usd_btc_a_panel"].attr("data-flaunt",HUOBI.BALANCE.usd_btc_available).html("<b>"+l[0]+"</b>."+l[1])}).on("__LoanUpdate",function(a){j["#cny_cny_l_panel"].html(k(A.cny_loan_enable,2)).attr({"data-enable":A.cny_loan_enable,"data-total":A.cny_loan_total}),j["#cny_btc_l_panel"].html(k(A.cny_btc_loan_enable,4)).attr({"data-enable":A.cny_btc_loan_enable,"data-total":A.cny_btc_loan_total}),j["#cny_ltc_l_panel"].html(k(A.cny_ltc_loan_enable,4)).attr({"data-enable":A.cny_ltc_loan_enable,"data-total":A.cny_ltc_loan_total}),j["#usd_usd_l_panel"].html(k(A.usd_loan_enable,2)).attr({"data-enable":A.usd_loan_enable,"data-total":A.usd_loan_total}),j["#usd_btc_l_panel"].html(k(A.usd_btc_loan_enable,4)).attr({"data-enable":A.usd_btc_loan_enable,"data-total":A.usd_btc_loan_total}),$.each(A,function(a,t){if(a.indexOf("_loan_enable")>0){var e=a.replace("_loan_enable",""),n=$("#"+e+"_loan_switch");t?n.prop("disabled",!1).trigger("__Update"):n.prop("disabled",!0).trigger("__Update")}})}).on("__OrderType",function(a,t){e(q,t),f(j[".form_trade"].eq(0)),f(j[".form_trade"].eq(1))}).on("__FormChange",function(a,t,e,n,r){var l=c(e,n,t._DTA),o=t.find('[name="loan_type"]');d([l,n],t._VAV,t._type,t._DLA,t._VLT),o.attr("data-loan-state",0)}).on("__FormMax",function(a,t,e,n){_(e),p(t._type,t._DMaxB,t.amount,t.market_transaction_amount||t.market_amount)}),j.on("__TradeFormValidation",function(a,t){t.trigger("__FormActive")}).on("__TradeFormBeforeSubmit",function(a,t){var e=t.attr("data-form-type"),n=t.find(":submit"),r=n.data("msg-submit").split(","),o=(n.text(),t.find('[name="trade_type"]').val());if("plan"===e?o&&(1==o?n.text(r[0]+r[2]):n.text(r[1]+r[2])):n.text(r[1]+r[r.length-1]),l(t))return!1}).on("__TradeFormCallback",function(a,t,e){var n=t.attr("data-form-type"),r=t.find(":submit"),l=r.data("msg-submit").split(","),_=(r.text(),t.find('[name="trade_type"]').val());0==e.code?(o()||$(".trade_pwd_group").hide(),"edit"===n&&(ua.Close(),"entrust"==W&&V.reload(1)),"plan"===n?(pa.Fire(),pa.Play(),ba.Close(),ia[0].Close(),ia[1].Close(),_&&(1==_?r.text(l[0]):r.text(l[1]))):(r.text(l[0]),K&&("PlaceMarketOrder"===q?setTimeout(function(){K.Fire()},1e3):setTimeout(function(){K.Fire()},500))),X&&X.Play(),f(t),U({msg:e.msg,delay:3e3})):("plan"===n?_&&(1==_?r.text(l[0]):r.text(l[1])):r.text(l[0]),U({msg:e.msg,type:"error"})),J.Fire()}).on("__TradeFormError",function(a,t){var e=(t.attr("data-form-type"),t.find(":submit")),n=e.data("msg-submit").split(",");U({msg:window.Texts&&Texts.NetworkError,type:"error"}),e.text(n[0])}).on("__GetLoan",function(a,t,e,n){var r,l=t,o=l.loan_type,_=o.data("loan-type"),c=t.find(":submit"),d=c.data("msg-submit").split(",");Q({loan_type:_,amount:n},function(a){switch(a.code){case"loading":o.attr("data-loan-state",1),c.text(d[2]+d[3]);break;case"error":o.attr("data-loan-state",0);break;case"success":if(r=a.data,0===r.code){o.attr("data-loan-state",2),J.Fire(),j.trigger("__UpLoan",[R,"loan success"]),t.submit();break}U({msg:r.msg,type:"error"}),o.attr("data-loan-state",0),c.text(d[0])}})}).on("__UpLoan",function(a,t,e){switch(t){case"cny_btc":Y.Fire();break;case"cny_ltc":Z.Fire();break;case"usd_btc":aa.Fire()}}).on("__OrderCancel",function(a){f(j[".form_trade"].eq(0)),f(j[".form_trade"].eq(1)),setTimeout(function(){j.trigger("__UpLoan",[R,"Order Cancel"])},500)})});
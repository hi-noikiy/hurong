define(function(require,exports,module){function t(t,e,n){var a=t.current(),l=a.search(e);return l>-1?t.backUp(a.length-l):a.match(/<\/?$/)&&(t.backUp(a.length),t.match(e,!1)||t.match(a)),n}function e(t){var e=i[t];return e||(i[t]=new RegExp("\\s+"+t+"\\s*=\\s*('|\")?([^'\"]+)('|\")?\\s*"))}function n(t,n){var a=t.match(e(n));return a?/^\s*(.*?)\s*$/.exec(a[2])[1]:""}function a(t,e){return new RegExp((e?"^":"")+"</s*"+t+"s*>","i")}function l(t,e){for(var n in t)for(var a=e[n]||(e[n]=[]),l=t[n],r=l.length-1;r>=0;r--)a.unshift(l[r])}function r(t,e){for(var a=0;a<t.length;a++){var l=t[a];if(!l[0]||l[1].test(n(e,l[0])))return l[2]}}require("lib/codeonline/lib/codemirror.js");var o={script:[["lang",/(javascript|babel)/i,"javascript"],["type",/^(?:text|application)\/(?:x-)?(?:java|ecma)script$|^module$|^$/i,"javascript"],["type",/./,"text/plain"],[null,null,"javascript"]],style:[["lang",/^css$/i,"css"],["type",/^(text\/)?(x-)?(stylesheet|css)$/i,"css"],["type",/./,"text/plain"],[null,null,"css"]]},i={};CodeMirror.defineMode("htmlmixed",function(e,n){function i(n,l){var o,u=c.token(n,l.htmlState),d=/\btag\b/.test(u);if(d&&!/[<>\s\/]/.test(n.current())&&(o=l.htmlState.tagName&&l.htmlState.tagName.toLowerCase())&&s.hasOwnProperty(o))l.inTag=o+" ";else if(l.inTag&&d&&/>$/.test(n.current())){var m=/^([\S]+) (.*)/.exec(l.inTag);l.inTag=null;var g=">"==n.current()&&r(s[m[1]],m[2]),h=CodeMirror.getMode(e,g),f=a(m[1],!0),p=a(m[1],!1);l.token=function(e,n){return e.match(f,!1)?(n.token=i,n.localState=n.localMode=null,null):t(e,p,n.localMode.token(e,n.localState))},l.localMode=h,l.localState=CodeMirror.startState(h,c.indent(l.htmlState,""))}else l.inTag&&(l.inTag+=n.current(),n.eol()&&(l.inTag+=" "));return u}var c=CodeMirror.getMode(e,{name:"xml",htmlMode:!0,multilineTagIndentFactor:n.multilineTagIndentFactor,multilineTagIndentPastTag:n.multilineTagIndentPastTag}),s={},u=n&&n.tags,d=n&&n.scriptTypes;if(l(o,s),u&&l(u,s),d)for(var m=d.length-1;m>=0;m--)s.script.unshift(["type",d[m].matches,d[m].mode]);return{startState:function(){return{token:i,inTag:null,localMode:null,localState:null,htmlState:CodeMirror.startState(c)}},copyState:function(t){var e;return t.localState&&(e=CodeMirror.copyState(t.localMode,t.localState)),{token:t.token,inTag:t.inTag,localMode:t.localMode,localState:e,htmlState:CodeMirror.copyState(c,t.htmlState)}},token:function(t,e){return e.token(t,e)},indent:function(t,e,n){return!t.localMode||/^\s*<\//.test(e)?c.indent(t.htmlState,e):t.localMode.indent?t.localMode.indent(t.localState,e,n):CodeMirror.Pass},innerMode:function(t){return{state:t.localState||t.htmlState,mode:t.localMode||c}}}},"xml","javascript","css"),CodeMirror.defineMIME("text/html","htmlmixed")});
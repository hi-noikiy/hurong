define(function(require,exports,module){require("lib/codeonline/lib/codemirror.js"),CodeMirror.defineMode("markdown",function(t,e){function i(e){if(CodeMirror.findModeByName){var i=CodeMirror.findModeByName(e);i&&(e=i.mime||i.mimes[0])}var n=CodeMirror.getMode(t,e);return"null"==n.name?null:n}function n(t,e,i){return e.f=e.inline=i,i(t,e)}function r(t,e,i){return e.f=e.block=i,i(t,e)}function a(t){return!t||!/\S/.test(t.string)}function o(t){return t.linkTitle=!1,t.em=!1,t.strong=!1,t.strikethrough=!1,t.quote=0,t.indentedCode=!1,t.f==h&&(t.f=f,t.block=l),t.trailingSpace=0,t.trailingSpaceNewLine=!1,t.prevLine=t.thisLine,t.thisLine=null,null}function l(t,r){var o=t.sol(),l=!1!==r.list,h=r.indentedCode;r.indentedCode=!1,l&&(r.indentationDiff>=0?(r.indentationDiff<4&&(r.indentation-=r.indentationDiff),r.list=null):r.indentation>0?r.list=null:r.list=!1);var u=null;if(r.indentationDiff>=4)return t.skipToEnd(),h||a(r.prevLine)?(r.indentation-=4,r.indentedCode=!0,M.code):null;if(t.eatSpace())return null;if((u=t.match(q))&&u[1].length<=6)return r.header=u[1].length,e.highlightFormatting&&(r.formatting="header"),r.f=r.inline,s(r);if(!(a(r.prevLine)||r.quote||l||h)&&(u=t.match(b)))return r.header="="==u[0].charAt(0)?1:2,e.highlightFormatting&&(r.formatting="header"),r.f=r.inline,s(r);if(t.eat(">"))return r.quote=o?1:r.quote+1,e.highlightFormatting&&(r.formatting="quote"),t.eatSpace(),s(r);if("["===t.peek())return n(t,r,k);if(t.match(T,!0))return r.hr=!0,M.hr;if(u=t.match(C)){var f=u[1]?"ol":"ul";for(r.indentation=t.column()+t.current().length,r.list=!0;r.listStack&&t.column()<r.listStack[r.listStack.length-1];)r.listStack.pop();return r.listStack.push(r.indentation),e.taskLists&&t.match(F,!1)&&(r.taskList=!0),r.f=r.inline,e.highlightFormatting&&(r.formatting=["list","list-"+f]),s(r)}return e.fencedCodeBlocks&&(u=t.match(y,!0))?(r.fencedChars=u[1],r.localMode=i(u[2]),r.localMode&&(r.localState=CodeMirror.startState(r.localMode)),r.f=r.block=g,e.highlightFormatting&&(r.formatting="code-block"),r.code=-1,s(r)):n(t,r,r.inline)}function h(t,e){var i=S.token(t,e.htmlState);if(!x){var n=CodeMirror.innerMode(S,e.htmlState);("xml"==n.mode.name&&null===n.state.tagStart&&!n.state.context&&n.state.tokenize.isInText||e.md_inside&&t.current().indexOf(">")>-1)&&(e.f=f,e.block=l,e.htmlState=null)}return i}function g(t,i){if(i.fencedChars&&t.match(i.fencedChars)){e.highlightFormatting&&(i.formatting="code-block");var n=s(i);return i.localMode=i.localState=null,i.block=l,i.f=f,i.fencedChars=null,i.code=0,n}return i.fencedChars&&t.skipTo(i.fencedChars)?"comment":i.localMode?i.localMode.token(t,i.localState):(t.skipToEnd(),M.code)}function s(t){var i=[];if(t.formatting){i.push(M.formatting),"string"==typeof t.formatting&&(t.formatting=[t.formatting]);for(var n=0;n<t.formatting.length;n++)i.push(M.formatting+"-"+t.formatting[n]),"header"===t.formatting[n]&&i.push(M.formatting+"-"+t.formatting[n]+"-"+t.header),"quote"===t.formatting[n]&&(!e.maxBlockquoteDepth||e.maxBlockquoteDepth>=t.quote?i.push(M.formatting+"-"+t.formatting[n]+"-"+t.quote):i.push("error"))}if(t.taskOpen)return i.push("meta"),i.length?i.join(" "):null;if(t.taskClosed)return i.push("property"),i.length?i.join(" "):null;if(t.linkHref?i.push(M.linkHref,"url"):(t.strong&&i.push(M.strong),t.em&&i.push(M.em),t.strikethrough&&i.push(M.strikethrough),t.linkText&&i.push(M.linkText),t.code&&i.push(M.code),t.image&&i.push(M.image),t.imageAltText&&i.push(M.imageAltText,"link"),t.imageMarker&&i.push(M.imageMarker)),t.header&&i.push(M.header,M.header+"-"+t.header),t.quote&&(i.push(M.quote),!e.maxBlockquoteDepth||e.maxBlockquoteDepth>=t.quote?i.push(M.quote+"-"+t.quote):i.push(M.quote+"-"+e.maxBlockquoteDepth)),!1!==t.list){var r=(t.listStack.length-1)%3;r?1===r?i.push(M.list2):i.push(M.list3):i.push(M.list1)}return t.trailingSpaceNewLine?i.push("trailing-space-new-line"):t.trailingSpace&&i.push("trailing-space-"+(t.trailingSpace%2?"a":"b")),i.length?i.join(" "):null}function u(t,e){if(t.match(w,!0))return s(e)}function f(t,i){var n=i.text(t,i);if(void 0!==n)return n;if(i.list)return i.list=null,s(i);if(i.taskList){return"x"!==t.match(F,!0)[1]?i.taskOpen=!0:i.taskClosed=!0,e.highlightFormatting&&(i.formatting="task"),i.taskList=!1,s(i)}if(i.taskOpen=!1,i.taskClosed=!1,i.header&&t.match(/^#+$/,!0))return e.highlightFormatting&&(i.formatting="header"),s(i);var a=t.next();if(i.linkTitle){i.linkTitle=!1;var o=a;"("===a&&(o=")"),o=(o+"").replace(/([.?*+^\[\]\\(){}|-])/g,"\\$1");var l="^\\s*(?:[^"+o+"\\\\]+|\\\\\\\\|\\\\.)"+o;if(t.match(new RegExp(l),!0))return M.linkHref}if("`"===a){var g=i.formatting;e.highlightFormatting&&(i.formatting="code"),t.eatWhile("`");var u=t.current().length;if(0==i.code)return i.code=u,s(i);if(u==i.code){var d=s(i);return i.code=0,d}return i.formatting=g,s(i)}if(i.code)return s(i);if("\\"===a&&(t.next(),e.highlightFormatting)){var k=s(i),p=M.formatting+"-escape";return k?k+" "+p:p}if("!"===a&&t.match(/\[[^\]]*\] ?(?:\(|\[)/,!1))return i.imageMarker=!0,i.image=!0,e.highlightFormatting&&(i.formatting="image"),s(i);if("["===a&&i.imageMarker&&t.match(/[^\]]*\](\(.*?\)| ?\[.*?\])/,!1))return i.imageMarker=!1,i.imageAltText=!0,e.highlightFormatting&&(i.formatting="image"),s(i);if("]"===a&&i.imageAltText){e.highlightFormatting&&(i.formatting="image");var k=s(i);return i.imageAltText=!1,i.image=!1,i.inline=i.f=c,k}if("["===a&&!i.image)return i.linkText=!0,e.highlightFormatting&&(i.formatting="link"),s(i);if("]"===a&&i.linkText){e.highlightFormatting&&(i.formatting="link");var k=s(i);return i.linkText=!1,i.inline=i.f=t.match(/\(.*?\)| ?\[.*?\]/,!1)?c:f,k}if("<"===a&&t.match(/^(https?|ftps?):\/\/(?:[^\\>]|\\.)+>/,!1)){i.f=i.inline=m,e.highlightFormatting&&(i.formatting="link");var k=s(i);return k?k+=" ":k="",k+M.linkInline}if("<"===a&&t.match(/^[^> \\]+@(?:[^\\>]|\\.)+>/,!1)){i.f=i.inline=m,e.highlightFormatting&&(i.formatting="link");var k=s(i);return k?k+=" ":k="",k+M.linkEmail}if("<"===a&&t.match(/^(!--|[a-z]+(?:\s+[a-z_:.\-]+(?:\s*=\s*[^ >]+)?)*\s*>)/i,!1)){var v=t.string.indexOf(">",t.pos);if(-1!=v){/markdown\s*=\s*('|"){0,1}1('|"){0,1}/.test(t.string.substring(t.start,v))&&(i.md_inside=!0)}return t.backUp(1),i.htmlState=CodeMirror.startState(S),r(t,i,h)}if("<"===a&&t.match(/^\/\w*?>/))return i.md_inside=!1,"tag";if("*"===a||"_"===a){for(var x=1,L=1==t.pos?" ":t.string.charAt(t.pos-2);x<3&&t.eat(a);)x++;var T=t.peek()||" ",C=!/\s/.test(T)&&(!B.test(T)||/\s/.test(L)||B.test(L)),q=!/\s/.test(L)&&(!B.test(L)||/\s/.test(T)||B.test(T)),b=null,w=null;if(x%2&&(i.em||!C||"*"!==a&&q&&!B.test(L)?i.em!=a||!q||"*"!==a&&C&&!B.test(T)||(b=!1):b=!0),x>1&&(i.strong||!C||"*"!==a&&q&&!B.test(L)?i.strong!=a||!q||"*"!==a&&C&&!B.test(T)||(w=!1):w=!0),null!=w||null!=b){e.highlightFormatting&&(i.formatting=null==b?"strong":null==w?"em":"strong em"),!0===b&&(i.em=a),!0===w&&(i.strong=a);var d=s(i);return!1===b&&(i.em=!1),!1===w&&(i.strong=!1),d}}else if(" "===a&&(t.eat("*")||t.eat("_"))){if(" "===t.peek())return s(i);t.backUp(1)}if(e.strikethrough)if("~"===a&&t.eatWhile(a)){if(i.strikethrough){e.highlightFormatting&&(i.formatting="strikethrough");var d=s(i);return i.strikethrough=!1,d}if(t.match(/^[^\s]/,!1))return i.strikethrough=!0,e.highlightFormatting&&(i.formatting="strikethrough"),s(i)}else if(" "===a&&t.match(/^~~/,!0)){if(" "===t.peek())return s(i);t.backUp(2)}return" "===a&&(t.match(/ +$/,!1)?i.trailingSpace++:i.trailingSpace&&(i.trailingSpaceNewLine=!0)),s(i)}function m(t,i){if(">"===t.next()){i.f=i.inline=f,e.highlightFormatting&&(i.formatting="link");var n=s(i);return n?n+=" ":n="",n+M.linkInline}return t.match(/^[^>]+/,!0),M.linkInline}function c(t,i){if(t.eatSpace())return null;var n=t.next();return"("===n||"["===n?(i.f=i.inline=d("("===n?")":"]"),e.highlightFormatting&&(i.formatting="link-string"),i.linkHref=!0,s(i)):"error"}function d(t){return function(i,n){if(i.next()===t){n.f=n.inline=f,e.highlightFormatting&&(n.formatting="link-string");var r=s(n);return n.linkHref=!1,r}return i.match(D[t]),n.linkHref=!0,s(n)}}function k(t,i){return t.match(/^([^\]\\]|\\.)*\]:/,!1)?(i.f=p,t.next(),e.highlightFormatting&&(i.formatting="link"),i.linkText=!0,s(i)):n(t,i,f)}function p(t,i){if(t.match(/^\]:/,!0)){i.f=i.inline=v,e.highlightFormatting&&(i.formatting="link");var n=s(i);return i.linkText=!1,n}return t.match(/^([^\]\\]|\\.)+/,!0),M.linkText}function v(t,e){return t.eatSpace()?null:(t.match(/^[^\s]+/,!0),void 0===t.peek()?e.linkTitle=!0:t.match(/^(?:\s+(?:"(?:[^"\\]|\\\\|\\.)+"|'(?:[^'\\]|\\\\|\\.)+'|\((?:[^)\\]|\\\\|\\.)+\)))?/,!0),e.f=e.inline=f,M.linkHref+" url")}var S=CodeMirror.getMode(t,"text/html"),x="null"==S.name;void 0===e.highlightFormatting&&(e.highlightFormatting=!1),void 0===e.maxBlockquoteDepth&&(e.maxBlockquoteDepth=0),void 0===e.taskLists&&(e.taskLists=!1),void 0===e.strikethrough&&(e.strikethrough=!1),void 0===e.tokenTypeOverrides&&(e.tokenTypeOverrides={});var M={header:"header",code:"comment",quote:"quote",list1:"variable-2",list2:"variable-3",list3:"keyword",hr:"hr",image:"image",imageAltText:"image-alt-text",imageMarker:"image-marker",formatting:"formatting",linkInline:"link",linkEmail:"link",linkText:"link",linkHref:"string",em:"em",strong:"strong",strikethrough:"strikethrough"};for(var L in M)M.hasOwnProperty(L)&&e.tokenTypeOverrides[L]&&(M[L]=e.tokenTypeOverrides[L]);var T=/^([*\-_])(?:\s*\1){2,}\s*$/,C=/^(?:[*\-+]|^[0-9]+([.)]))\s+/,F=/^\[(x| )\](?=\s)/,q=e.allowAtxHeaderWithoutSpace?/^(#+)/:/^(#+)(?: |$)/,b=/^ *(?:\={1,}|-{1,})\s*$/,w=/^[^#!\[\]*_\\<>` "'(~]+/,y=new RegExp("^("+(!0===e.fencedCodeBlocks?"~~~+|```+":e.fencedCodeBlocks)+")[ \\t]*([\\w+#-]*)"),B=/[!\"#$%&\'()*+,\-\.\/:;<=>?@\[\\\]^_`{|}~â€”]/,D={")":/^(?:[^\\\(\)]|\\.|\((?:[^\\\(\)]|\\.)*\))*?(?=\))/,"]":/^(?:[^\\\[\]]|\\.|\[(?:[^\\\[\]]|\\.)*\])*?(?=\])/},_={startState:function(){return{f:l,prevLine:null,thisLine:null,block:l,htmlState:null,indentation:0,inline:f,text:u,formatting:!1,linkText:!1,linkHref:!1,linkTitle:!1,code:0,em:!1,strong:!1,header:0,hr:!1,taskList:!1,list:!1,listStack:[],quote:0,trailingSpace:0,trailingSpaceNewLine:!1,strikethrough:!1,fencedChars:null}},copyState:function(t){return{f:t.f,prevLine:t.prevLine,thisLine:t.thisLine,block:t.block,htmlState:t.htmlState&&CodeMirror.copyState(S,t.htmlState),indentation:t.indentation,localMode:t.localMode,localState:t.localMode?CodeMirror.copyState(t.localMode,t.localState):null,inline:t.inline,text:t.text,formatting:!1,linkText:t.linkText,linkTitle:t.linkTitle,code:t.code,em:t.em,strong:t.strong,strikethrough:t.strikethrough,header:t.header,hr:t.hr,taskList:t.taskList,list:t.list,listStack:t.listStack.slice(0),quote:t.quote,indentedCode:t.indentedCode,trailingSpace:t.trailingSpace,trailingSpaceNewLine:t.trailingSpaceNewLine,md_inside:t.md_inside,fencedChars:t.fencedChars}},token:function(t,e){if(e.formatting=!1,t!=e.thisLine){var i=e.header||e.hr;if(e.header=0,e.hr=!1,t.match(/^\s*$/,!0)||i){if(o(e),!i)return null;e.prevLine=null}e.prevLine=e.thisLine,e.thisLine=t,e.taskList=!1,e.trailingSpace=0,e.trailingSpaceNewLine=!1,e.f=e.block;var n=t.match(/^\s*/,!0)[0].replace(/\t/g,"    ").length;if(e.indentationDiff=Math.min(n-e.indentation,4),e.indentation=e.indentation+e.indentationDiff,n>0)return null}return e.f(t,e)},innerMode:function(t){return t.block==h?{state:t.htmlState,mode:S}:t.localState?{state:t.localState,mode:t.localMode}:{state:t,mode:_}},blankLine:o,getType:s,closeBrackets:"()[]{}''\"\"``",fold:"markdown"};return _},"xml"),CodeMirror.defineMIME("text/x-markdown","markdown")});
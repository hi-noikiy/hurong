define(function(require,exports,module){require("lib/codeonline/lib/codemirror.js"),CodeMirror.registerHelper("fold","brace",function(r,e){function n(n){for(var l=e.ch,f=0;;){var s=l<=0?-1:t.lastIndexOf(n,l-1);if(-1!=s){if(1==f&&s<e.ch)break;if(i=r.getTokenTypeAt(CodeMirror.Pos(o,s+1)),!/^(comment|string)/.test(i))return s+1;l=s-1}else{if(1==f)break;f=1,l=t.length}}}var i,o=e.line,t=r.getLine(o),l="{",f="}",s=n("{");if(null==s&&(l="[",f="]",s=n("[")),null!=s){var d,a,u=1,g=r.lastLine();r:for(var c=o;c<=g;++c)for(var v=r.getLine(c),C=c==o?s:0;;){var M=v.indexOf(l,C),P=v.indexOf(f,C);if(M<0&&(M=v.length),P<0&&(P=v.length),(C=Math.min(M,P))==v.length)break;if(r.getTokenTypeAt(CodeMirror.Pos(c,C+1))==i)if(C==M)++u;else if(!--u){d=c,a=C;break r}++C}if(null!=d&&(o!=d||a!=s))return{from:CodeMirror.Pos(o,s),to:CodeMirror.Pos(d,a)}}}),CodeMirror.registerHelper("fold","import",function(r,e){function n(e){if(e<r.firstLine()||e>r.lastLine())return null;var n=r.getTokenAt(CodeMirror.Pos(e,1));if(/\S/.test(n.string)||(n=r.getTokenAt(CodeMirror.Pos(e,n.end+1))),"keyword"!=n.type||"import"!=n.string)return null;for(var i=e,o=Math.min(r.lastLine(),e+10);i<=o;++i){var t=r.getLine(i),l=t.indexOf(";");if(-1!=l)return{startCh:n.end,end:CodeMirror.Pos(i,l)}}}var i,o=e.line,t=n(o);if(!t||n(o-1)||(i=n(o-2))&&i.end.line==o-1)return null;for(var l=t.end;;){var f=n(l.line+1);if(null==f)break;l=f.end}return{from:r.clipPos(CodeMirror.Pos(o,t.startCh+1)),to:l}}),CodeMirror.registerHelper("fold","include",function(r,e){function n(e){if(e<r.firstLine()||e>r.lastLine())return null;var n=r.getTokenAt(CodeMirror.Pos(e,1));return/\S/.test(n.string)||(n=r.getTokenAt(CodeMirror.Pos(e,n.end+1))),"meta"==n.type&&"#include"==n.string.slice(0,8)?n.start+8:void 0}var i=e.line,o=n(i);if(null==o||null!=n(i-1))return null;for(var t=i;;){if(null==n(t+1))break;++t}return{from:CodeMirror.Pos(i,o+1),to:r.clipPos(CodeMirror.Pos(t))}})});